
allprojects {
    apply plugin: 'java-library'

    repositories {
        mavenCentral()
    }

    configurations {
        customLib {
            canBeResolved = true
            canBeConsumed = true
        }
        implementation.extendsFrom(customLib)
    }

    dependencyLocking {
        lockAllConfigurations()
        lockFile.set(new File(rootProject.projectDir, "${name}.lockfile"))
    }

}

dependencies {
    customLib('com.fasterxml.jackson.core:jackson-databind:2.13.4.2')
}

tasks.register('resolveAndLockAll') {
    notCompatibleWithConfigurationCache("Filters configurations at execution time")
    doLast {
      subprojects.each { project ->
        project.configurations.findAll {
          it.canBeResolved && it.name == "customLib"
        }.each {
          it.resolve()
        }
      }
    }
}
